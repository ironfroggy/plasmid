<!doctype html>

<ul id="items">
</ul>

<input type="text" id="entry"></input>
<button id="add">Add</button>

<script type="text/javascript" src="base64.js"></script>
<script type="text/javascript" src="plasmid.js"></script>
<script type="text/javascript">
    const api = window.location.protocol + '//' + window.location.host + '/api/';
    const access = "test";
    const secret = "test";

    var database = new plasmid.Database({
        name: 'todo',
        api: api,
        schema: {
            version: 1,
            stores: {
                todo: {
                    sync: true,
                    indexes: {
                        todo: {key: "todo", unique: false, multi: false}
                    }
                },
            },
        },
        access: access,
        secret: secret
    });

    database.on('opensuccess', show);

    function show() {
        $items.innerHTML = "";
        database.stores.todo.walk('todo').on('each', function(item){
            $items.innerHTML = $items.innerHTML + ('<li>' + item.value.todo + '</li>');
        });
    }

    var $items = document.getElementById('items');
    var $entry = document.getElementById('entry');
    var $add = document.getElementById('add');

    $add.onclick = function(){
        var value = $entry.value;
        $entry.value = "";
        database.stores.todo.put(
            Base64.encode(Math.random().toString()),
            {todo: value, complete: false}
        ).then(function(){
            console.log("sync...");
            database.sync().then(show);
        });
        $items.innerHTML = $items.innerHTML + ('<li>' + value + '</li>');
    };
</script>
